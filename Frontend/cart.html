<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FreshCart – Your Cart</title>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --primary-50:#ecfdf5;
      --primary-100:#d1fae5;
      --primary-200:#a7f3d0;
      --primary-300:#6ee7b7;
      --primary-400:#34d399;
      --primary:#10b981;
      --primary-600:#059669;
      --primary-700:#047857;
      --ink:#0f172a;
      --muted:#64748b;
      --bg:#f8fafc;
      --card:#fff;
      --radius:16px;
      --shadow:0 10px 25px rgba(2,6,23,.08);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:var(--ink);background:var(--bg)}
    a{text-decoration:none;color:inherit}
    .container{max-width:1200px;margin:0 auto;padding:20px}
    h1,h2,h3{margin:0}
    .btn{display:inline-flex;align-items:center;gap:10px;border:0;border-radius:12px;padding:12px 18px;background:linear-gradient(135deg,var(--primary),var(--primary-600));color:#fff;font-weight:600;cursor:pointer;box-shadow:var(--shadow)}
    .btn:active{transform:translateY(1px)}

    /* NAVBAR */
    .nav{position:sticky;top:0;z-index:50;background:linear-gradient(180deg,#0fbf78,#0ca26b);box-shadow:0 4px 18px rgba(2,6,23,.08)}
    .nav .inner{display:flex;align-items:center;gap:18px;justify-content:space-between;padding:12px 20px}
    .brand{display:flex;align-items:center;gap:10px;color:#fff;text-decoration:none;font-family:Pacifico,cursive;font-size:28px}
    .nav-links{display:flex;gap:18px}
    .nav-links a{color:#fff;font-weight:500}
    .nav-actions{display:flex;align-items:center;gap:14px}
    .cart{position:relative;color:#0f172a;background:#fff;border-radius:12px;padding:8px 12px;font-weight:700;cursor:pointer}
    .cart__badge{position:absolute;top:-8px;right:-8px;background:#ef4444;color:#fff;font-weight:700;border-radius:999px;min-width:22px;height:22px;display:grid;place-items:center;font-size:12px;border:2px solid #fff}

    /* CART PAGE */
    .cart-section{padding:40px 0}
    .cart-items{display:grid;gap:20px;margin-top:20px}
    .cart-item{display:flex;gap:16px;background:var(--card);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow);align-items:center}
    .cart-item img{width:100px;height:100px;object-fit:cover;border-radius:12px}
    .cart-item .details{flex:1}
    .cart-item .details h3{margin-bottom:6px}
    .cart-item .details .meta{color:var(--muted);font-size:14px}
    .cart-item .actions{display:flex;gap:6px;align-items:center}
    .cart-item .actions button{padding:4px 8px;border:none;border-radius:8px;cursor:pointer;font-size:14px}
    .cart-item .actions .remove{color:red}
    .total-box{margin-top:24px;background:var(--card);padding:20px;border-radius:var(--radius);box-shadow:var(--shadow);display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px}
    .empty-cart{text-align:center;color:var(--muted);margin-top:50px;font-size:18px}

    /* FOOTER */
    footer{margin-top:56px;background:linear-gradient(180deg, #075e46, #064e3b);color:#e5f9f1}
    footer .inner{padding:30px 20px;display:grid;grid-template-columns:2fr 1fr 1fr 1fr;gap:20px}
    @media(max-width:900px){footer .inner{grid-template-columns:1fr 1fr}}
    @media(max-width:600px){footer .inner{grid-template-columns:1fr}}
    footer a{color:#c8f5e6}
    footer .bottom{border-top:1px solid #ffffff22;padding:12px 0;text-align:center;color:#a7f3d0}

    /* TOAST */
    .toast{position:fixed;left:50%;bottom:22px;transform:translateX(-50%);background:#0f172a;color:#fff;padding:12px 16px;border-radius:12px;box-shadow:var(--shadow);opacity:0;pointer-events:none;transition:.3s}
    .toast.show{opacity:1;pointer-events:auto}
  </style>
</head>
<body>

<!-- NAVBAR -->
<header class="nav">
  <div class="inner container">
    <a href="index.html" class="brand">FreshCart</a>
    <nav class="nav-links">
      <a href="index.html">Home</a>
      <a href="products.html">Products</a>
      <a href="orders.html">Orders</a>
      <a href="support.html">Support</a>
    </nav>
    <div class="nav-actions">
      <div class="cart" id="cartBtn">
        🛒 Cart <span class="cart__badge" id="cartCount">0</span>
      </div>
    </div>
  </div>
</header>

<!-- CART CONTENT -->
<section class="cart-section container">
  <h1>Your Shopping Cart</h1>
  <div id="cartItems" class="cart-items"></div>

  <div id="totalBox" class="total-box" style="display:none">
    <b>Total:</b>
    <span id="cartTotal">₹0</span>
    <button class="btn" id="checkoutBtn">Checkout</button>
  </div>

  <div id="emptyCartMsg" class="empty-cart">Your cart is empty 🛒</div>
</section>

<!-- FOOTER -->
<footer>
  <div class="container inner">
    <div>
      <div class="brand__logo" style="font-family:Pacifico,cursive;font-size:26px">FreshCart</div>
      <p class="meta" style="color:#d1fae5">Freshness delivered in minutes. 6AM–11PM daily.</p>
    </div>
    <div>
      <b>Shop</b>
      <ul style="list-style:none;padding:0;margin:10px 0 0;display:grid;gap:8px">
        <li><a href="index.html#categories">Fruits & Vegetables</a></li>
        <li><a href="index.html#popular">Popular Products</a></li>
        <li><a href="#">New Arrivals</a></li>
      </ul>
    </div>
    <div>
      <b>Company</b>
      <ul style="list-style:none;padding:0;margin:10px 0 0;display:grid;gap:8px">
        <li><a href="#">About</a></li>
        <li><a href="#">Careers</a></li>
        <li><a href="#">Help Center</a></li>
      </ul>
    </div>
    <div>
      <b>Get the app</b>
      <div style="display:grid;gap:10px;margin-top:10px">
        <a href="#" class="btn" style="background:#ffffff22;color:#fff;">📱 App Store</a>
        <a href="#" class="btn" style="background:#ffffff22;color:#fff;">▶ Play Store</a>
      </div>
    </div>
  </div>
  <div class="bottom">© 2025 FreshCart. All rights reserved.</div>
</footer>

<div class="toast" id="toast" role="status" aria-live="polite"></div>

<script>
const CART_KEY = 'freshcart_cart_items';
const cartItemsEl = document.getElementById('cartItems');
const cartTotalEl = document.getElementById('cartTotal');
const totalBox = document.getElementById('totalBox');
const emptyMsg = document.getElementById('emptyCartMsg');
const cartCountEl = document.getElementById('cartCount');

const token = localStorage.getItem("token");
const userId = localStorage.getItem("userId");

function getCart(){ try{ return JSON.parse(localStorage.getItem(CART_KEY)) || []; } catch { return []; } }
function setCart(items){ localStorage.setItem(CART_KEY, JSON.stringify(items)); }

function toast(msg){
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.classList.add('show');
  clearTimeout(window.__toastTimer);
  window.__toastTimer = setTimeout(()=> el.classList.remove('show'),1800);
}

function renderCart(){
  const cart = getCart();
  cartItemsEl.innerHTML='';
  let total=0;
  if(cart.length===0){
    totalBox.style.display='none';
    emptyMsg.style.display='block';
  } else {
    totalBox.style.display='flex';
    emptyMsg.style.display='none';
  }
  cart.forEach((item, idx)=>{
    const itemTotal = item.price * (item.qty || 1);
    total += itemTotal;
    const div = document.createElement('div');
    div.className='cart-item';
    div.innerHTML=`
      <img src="${item.image || 'https://picsum.photos/seed/'+item.name+'/200/200'}" alt="${item.name}">
      <div class="details">
        <h3>${item.name}</h3>
        <div class="meta">₹${item.price} × ${item.qty || 1}</div>
      </div>
      <div class="actions">
        <button onclick="changeQty(${idx},1)">＋</button>
        <button onclick="changeQty(${idx},-1)">−</button>
        <button class="remove" onclick="removeItem(${idx})">×</button>
      </div>
    `;
    cartItemsEl.appendChild(div);
  });
  cartTotalEl.textContent='₹'+total.toFixed(2);
  updateBadge();
}

function changeQty(idx, delta){
  const cart = getCart();
  cart[idx].qty = (cart[idx].qty || 1)+delta;
  if(cart[idx].qty <=0) cart.splice(idx,1);
  setCart(cart);
  renderCart();
}

function removeItem(idx){
  const cart = getCart();
  cart.splice(idx,1);
  setCart(cart);
  renderCart();
  toast('Item removed from cart ❌');
}

async function placeOrder(){
  if(!token || !userId){
    toast("Please login first 🔑");
    window.location.href="login.html";
    return;
  }
  const cart=getCart();
  if(cart.length===0){ toast("Cart is empty 🛒"); return; }

  try{
    const res=await fetch("http://localhost:3000/api/orders",{
      method:"POST",
      headers:{"Content-Type":"application/json","Authorization":"Bearer "+token},
      body:JSON.stringify({
        user:userId,
        items:cart.map(i=>({product:i.id,quantity:i.qty,price:i.price})),
        address:"Default Address",
        paymentMethod:"COD"
      })
    });
    if(!res.ok) throw new Error("Order failed");
    const data=await res.json();

    // Clear cart after success
    setCart([]);
    renderCart();
    toast("Order placed successfully ✅");

    // redirect optional
    // window.location.href="orders.html";

  }catch(e){
    console.error("Order error",e);
    toast("Error placing order ❌");
  }
}

document.getElementById('checkoutBtn').addEventListener('click',placeOrder);

function updateBadge(){
  const cart = getCart();
  let count = cart.reduce((acc,i)=> acc + (i.qty||1),0);
  cartCountEl.textContent = count;
}

renderCart();
</script>

<script>
  // --- Search Bar Handler (common across all pages) ---
  (function(){
    const searchInput = document.getElementById('searchInput');
    if(searchInput){
      searchInput.addEventListener('keydown', (e)=>{
        if(e.key === 'Enter'){
          const q = encodeURIComponent(searchInput.value.trim());
          // Redirect to products page with query string
          if(q){
            location.href = `products.html?q=${q}`;
          } else {
            location.href = 'products.html';
          }
        }
      });
    }
  })();
</script>


</body>
</html>
